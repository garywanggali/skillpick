{% extends 'core/base.html' %}

{% block content %}
<div style="text-align: center; margin-top: 20px;">
    <h2>今日学习主题</h2>
    <h1 style="font-size: 2.5em; margin: 20px 0; color: #007bff; word-break: break-word;">{{ topic.title }}</h1>
    <p>当前等级: <strong>{{ topic.get_current_level_display }}</strong></p>
    {% if topic.description %}
        <p style="color: #666;">{{ topic.description }}</p>
    {% endif %}

    {% if last_log %}
    <div style="background: #fff3cd; color: #856404; padding: 15px; border-radius: 8px; margin: 20px auto; max-width: 600px; text-align: left; border: 1px solid #ffeeba; box-sizing: border-box;">
        <h4 style="margin-top: 0;"><i class="fa-solid fa-clock-rotate-left"></i> 上次学习回顾 ({{ last_log.date }})</h4>
        <p style="margin-bottom: 0;">{{ last_log.feedback|default:"(没有详细记录)" }}</p>
        <p style="font-size: 0.8em; margin-top: 5px;">时长: {{ last_log.duration_minutes }} 分钟</p>
    </div>
    {% endif %}
    
    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 30px 0; border: 1px solid #e9ecef;">
        <h3><i class="fa-solid fa-tv"></i> AI 推荐视频资源</h3>
        {% if recommendation.recommended_video_url %}
            <p style="font-size: 1.1em; font-weight: bold;">为您找到以下视频：</p>
            <div style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin: 15px auto; max-width: 500px; box-sizing: border-box;">
                <p style="margin-top: 0; color: #333; font-weight: bold; word-break: break-word;">{{ recommendation.recommended_video_title }}</p>
                <a href="{{ recommendation.recommended_video_url }}" target="_blank" class="btn btn-block-mobile" style="background-color: #ff0000; display: block; margin-top: 10px;">
                    <i class="fa-solid fa-play-circle"></i> 点击观看视频
                </a>
            </div>
            <p style="font-size: 0.9em; color: #666; margin-top: 15px; font-style: italic; word-break: break-word;">
                <i class="fa-solid fa-lightbulb"></i> 推荐理由: {{ recommendation.recommended_reason }}
            </p>
        {% else %}
            <p>为你精选的搜索关键词:</p>
            <code style="display:block; margin: 10px; font-size: 1.1em; background: #fff; padding: 10px; border: 1px solid #ddd; word-break: break-word;">{{ search_query }}</code>
            <a href="{{ video_url }}" target="_blank" class="btn btn-block-mobile" style="background-color: #ff0000; margin-top: 10px;">
                <i class="fa-solid fa-play-circle"></i> 前往 Bilibili 观看 (建议 5-15 分钟)
            </a>
            <p style="font-size: 0.9em; margin-top: 15px; color: #666;">
                请根据你的当前水平选择合适的视频，观看完毕后记得打卡！
            </p>
        {% endif %}
    </div>

    <div style="margin-top: 40px; border-top: 1px solid #eee; padding-top: 20px; text-align: left; max-width: 600px; margin-left: auto; margin-right: auto;">
        <h3 style="text-align: center;"><i class="fa-solid fa-clipboard-check"></i> 学习打卡</h3>
        <form method="post" action="{% url 'log_progress' topic.id %}">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit" class="btn btn-block-mobile" style="background-color: #28a745; width: 100%;">保存进度</button>
        </form>
    </div>
</div>
{% endblock %}
