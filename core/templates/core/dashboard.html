{% extends 'core/base.html' %}

{% block content %}
<h2>æˆ‘çš„å­¦ä¹ åˆ—è¡¨</h2>

{% if topics %}
    {% if daily_topic %}
    <div style="background-color: #e8f5e9; border: 2px solid #4caf50; padding: 20px; border-radius: 8px; margin-bottom: 30px; text-align: center;">
        <h3 style="margin-top: 0; color: #2e7d32;"><i class="fa-solid fa-star"></i> ä»Šæ—¥æ¨è</h3>
        <p style="font-size: 1.5em; font-weight: bold; margin: 15px 0;">{{ daily_topic.title }}</p>
        <p style="color: #555;">å½“å‰ç­‰çº§: {{ daily_topic.get_current_level_display }}</p>
        
        {% if last_log %}
        <div style="background: white; padding: 10px; margin: 15px auto; max-width: 80%; border-radius: 4px; text-align: left; border-left: 4px solid #aaa;">
            <p style="margin: 0; font-size: 0.9em; color: #666;"><strong><i class="fa-solid fa-calendar-check"></i> ä¸Šæ¬¡å­¦ä¹  ({{ last_log.date }}):</strong></p>
            <p style="margin: 5px 0 0 0;">{{ last_log.feedback|default:"(æ— è¯¦ç»†å¿ƒå¾—)" }}</p>
        </div>
        {% else %}
        <p style="color: #888; font-size: 0.9em;">(è¯¥ä¸»é¢˜å°šæœªå¼€å§‹å­¦ä¹ )</p>
        {% endif %}

        <div style="margin-top: 20px; display: flex; flex-direction: column; gap: 10px;">
            {% if recommendation.recommended_video_url %}
            <a href="{{ recommendation.recommended_video_url }}" target="_blank" class="btn btn-block-mobile" style="background-color: #ff0000;">
                <i class="fa-solid fa-play-circle"></i> ä»Šæ—¥æ¨èè§†é¢‘
            </a>
            {% else %}
            <a href="{{ video_url }}" target="_blank" class="btn btn-block-mobile" style="background-color: #ff0000;">
                <i class="fa-solid fa-play-circle"></i> æŸ¥çœ‹ Bilibili æœç´¢ç»“æœ
            </a>
            {% endif %}
            <a href="{% url 'daily_pick' %}" class="btn btn-block-mobile" style="background-color: #2e7d32;">
                <i class="fa-solid fa-pen-to-square"></i> è®°å½•å­¦ä¹ è¿›åº¦
            </a>
        </div>
    </div>
    {% endif %}
    
    {% for topic in topics %}
        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                <div>
                    <h3 style="margin: 0; display: inline-block; vertical-align: middle;">{{ topic.title }}</h3>
                    <span style="background: #eee; padding: 2px 8px; border-radius: 10px; font-size: 0.8em; margin-left: 10px; vertical-align: middle;">{{ topic.get_current_level_display }}</span>
                </div>
                <div style="display: flex; gap: 5px;">
                    <form method="post" action="{% url 'topic_archive' topic.id %}" style="display: inline;">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-sm btn-outline" style="color: #f0ad4e; border-color: #f0ad4e;" title="æš‚å­˜ï¼ˆä¸æƒ³å­¦äº†ï¼‰"><i class="fa-solid fa-box-archive"></i></button>
                    </form>
                    <a href="{% url 'topic_edit' topic.id %}" class="btn btn-sm btn-outline" title="ç¼–è¾‘"><i class="fa-solid fa-pen"></i></a>
                </div>
            </div>
            {% if topic.description %}
                <p style="margin: 10px 0; color: #555;">{{ topic.description }}</p>
            {% endif %}
            <p style="font-size: 0.8em; color: #888; margin-top: 10px;">
                ä¸Šæ¬¡å­¦ä¹ : {{ topic.last_studied|default:"ä»æœªå¼€å§‹" }}
            </p>
        </div>
    {% endfor %}

    {% if archived_topics %}
    <h3 style="margin-top: 40px; color: #666; border-top: 1px solid #eee; padding-top: 20px;">ğŸ“¦ æš‚å­˜ç®±</h3>
    {% for topic in archived_topics %}
        <div class="card" style="background-color: #f9f9f9; opacity: 0.8;">
            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                <div>
                    <h3 style="margin: 0; display: inline-block; vertical-align: middle; color: #666;">{{ topic.title }}</h3>
                    <span style="background: #eee; padding: 2px 8px; border-radius: 10px; font-size: 0.8em; margin-left: 10px; vertical-align: middle;">{{ topic.get_current_level_display }}</span>
                </div>
                <div style="display: flex; gap: 5px;">
                    <form method="post" action="{% url 'topic_archive' topic.id %}" style="display: inline;">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-sm btn-outline" style="color: #28a745; border-color: #28a745;" title="æ¢å¤å­¦ä¹ "><i class="fa-solid fa-box-open"></i></button>
                    </form>
                    <form method="post" action="{% url 'topic_delete' topic.id %}" style="display: inline;" onsubmit="return confirm('ç¡®å®šè¦æ°¸ä¹…åˆ é™¤è¿™ä¸ªä¸»é¢˜å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚');">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-sm btn-outline" style="color: #dc3545; border-color: #dc3545;" title="æ°¸ä¹…åˆ é™¤"><i class="fa-solid fa-trash"></i></button>
                    </form>
                </div>
            </div>
            <p style="font-size: 0.8em; color: #999; margin-top: 10px;">
                å·²æš‚å­˜ â€¢ ä¸Šæ¬¡å­¦ä¹ : {{ topic.last_studied|default:"ä»æœªå¼€å§‹" }}
            </p>
        </div>
    {% endfor %}
    {% endif %}
{% else %}
    <div style="text-align: center; margin-top: 50px;">
        <p>ä½ è¿˜æ²¡æœ‰æ·»åŠ ä»»ä½•æƒ³å­¦çš„å†…å®¹ã€‚</p>
        <a href="{% url 'topic_add' %}" class="btn">æ·»åŠ ç¬¬ä¸€ä¸ªä¸»é¢˜</a>
    </div>
{% endif %}
{% endblock %}
